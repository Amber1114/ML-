<!-- pages/analysis/report/report.wxml -->
<view class="container">
  <!-- è´¢åŠ¡å¥åº·è¯„åˆ† -->
  <view class="health-score-card">
    <view class="score-header">
      <text class="title">è´¢åŠ¡å¥åº·è¯„åˆ†</text>
      <text class="month">{{currentMonth}}</text>
    </view>
    <view class="score-content">
      <view class="score-circle">
        <text class="score">{{healthScore}}</text>
        <text class="max-score">/100</text>
      </view>
      <text class="level" style="color: {{healthScore >= 90 ? '#27ae60' : healthScore >= 80 ? '#3498db' : healthScore >= 70 ? '#f39c12' : healthScore >= 60 ? '#e67e22' : '#e74c3c'}}">{{healthLevel}}</text>
    </view>
  </view>

  <!-- è¯„ä¼°ç»´åº¦è¯¦æƒ… -->
  <view class="assessment-dimensions">
    <text class="section-title">è¯„ä¼°ç»´åº¦è¯¦æƒ…</text>
    
    <!-- æ”¶æ”¯ç»“æ„ -->
    <view class="dimension-card">
      <view class="dimension-header">
        <text class="dimension-title">æ”¶æ”¯ç»“æ„</text>
        <text class="dimension-score">{{assessmentDetails.incomeStructureScore || 0}}/30</text>
      </view>
      <view class="dimension-progress">
        <view class="progress-bar" style="width: {{assessmentDetails.incomeStructureScore / 30 * 100}}%" wx:if="{{assessmentDetails.incomeStructureScore > 0}}"></view>
      </view>
      <view class="dimension-indicators">
        <view class="indicator-item">
          <text class="indicator-name">å‚¨è“„ç‡</text>
          <text class="indicator-value">{{assessmentDetails.savingsRate || '0'}}%</text>
        </view>
        <view class="indicator-item">
          <text class="indicator-name">æ”¶å…¥ç¨³å®šæ€§</text>
          <text class="indicator-value">{{assessmentDetails.incomeStability || '0'}}%</text>
        </view>
        <view class="indicator-item">
          <text class="indicator-name">æ¶ˆè´¹å æ¯”</text>
          <text class="indicator-value">{{assessmentDetails.expenseRatio || '0'}}%</text>
        </view>
      </view>
    </view>
    
    <!-- èµ„äº§è´Ÿå€ºçŠ¶å†µ -->
    <view class="dimension-card">
      <view class="dimension-header">
        <text class="dimension-title">èµ„äº§è´Ÿå€ºçŠ¶å†µ</text>
        <text class="dimension-score">{{assessmentDetails.assetLiabilityScore || 0}}/25</text>
      </view>
      <view class="dimension-progress">
        <view class="progress-bar" style="width: {{assessmentDetails.assetLiabilityScore / 25 * 100}}%" wx:if="{{assessmentDetails.assetLiabilityScore > 0}}"></view>
      </view>
      <view class="dimension-indicators">
        <view class="indicator-item">
          <text class="indicator-name">æ€»èµ„äº§</text>
          <text class="indicator-value">Â¥{{assessmentDetails.totalAssets || 0}}</text>
        </view>
        <view class="indicator-item">
          <text class="indicator-name">æ€»å€ºåŠ¡</text>
          <text class="indicator-value">Â¥{{assessmentDetails.totalDebt || 0}}</text>
        </view>
        <view class="indicator-item">
          <text class="indicator-name">å€ºåŠ¡æ”¶å…¥æ¯”</text>
          <text class="indicator-value">{{assessmentDetails.debtToIncomeRatio || '0'}}%</text>
        </view>
      </view>
    </view>
    
    <!-- è´¢åŠ¡å®‰å…¨ä¿éšœ -->
    <view class="dimension-card">
      <view class="dimension-header">
        <text class="dimension-title">è´¢åŠ¡å®‰å…¨ä¿éšœ</text>
        <text class="dimension-score">{{assessmentDetails.financialSecurityScore || 0}}/20</text>
      </view>
      <view class="dimension-progress">
        <view class="progress-bar" style="width: {{assessmentDetails.financialSecurityScore / 20 * 100}}%" wx:if="{{assessmentDetails.financialSecurityScore > 0}}"></view>
      </view>
      <view class="dimension-indicators">
        <view class="indicator-item">
          <text class="indicator-name">åº”æ€¥åŸºé‡‘æœˆæ•°</text>
          <text class="indicator-value">{{assessmentDetails.emergencyFundMonths || 0}}ä¸ªæœˆ</text>
        </view>
        <view class="indicator-item">
          <text class="indicator-name">æµåŠ¨æ€§æ¯”ç‡</text>
          <text class="indicator-value">{{assessmentDetails.liquidityRatio || 0}}x</text>
        </view>
      </view>
    </view>
    
    <!-- æ¶ˆè´¹è¡Œä¸ºåˆ†æ -->
    <view class="dimension-card">
      <view class="dimension-header">
        <text class="dimension-title">æ¶ˆè´¹è¡Œä¸ºåˆ†æ</text>
        <text class="dimension-score">{{assessmentDetails.consumptionBehaviorScore || 0}}/15</text>
      </view>
      <view class="dimension-progress">
        <view class="progress-bar" style="width: {{assessmentDetails.consumptionBehaviorScore / 15 * 100}}%" wx:if="{{assessmentDetails.consumptionBehaviorScore > 0}}"></view>
      </view>
      <view class="dimension-indicators">
        <view class="indicator-item">
          <text class="indicator-name">æ¶ˆè´¹å¤šæ ·æ€§</text>
          <text class="indicator-value">{{assessmentDetails.expenseDiversity || 0}}ç±»</text>
        </view>
      </view>
    </view>
    
    <!-- é•¿æœŸè´¢åŠ¡è§„åˆ’ -->
    <view class="dimension-card">
      <view class="dimension-header">
        <text class="dimension-title">é•¿æœŸè´¢åŠ¡è§„åˆ’</text>
        <text class="dimension-score">{{assessmentDetails.longTermPlanningScore || 0}}/10</text>
      </view>
      <view class="dimension-progress">
        <view class="progress-bar" style="width: {{assessmentDetails.longTermPlanningScore / 10 * 100}}%" wx:if="{{assessmentDetails.longTermPlanningScore > 0}}"></view>
      </view>
      <view class="dimension-indicators">
        <view class="indicator-item">
          <text class="indicator-name">èµ„äº§æ”¶å…¥æ¯”</text>
          <text class="indicator-value">{{assessmentDetails.assetToIncomeRatio || '0'}}x</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœˆåº¦æ”¶æ”¯ç»Ÿè®¡ -->
  <view class="stats-card">
    <text class="section-title">æœˆåº¦æ”¶æ”¯ç»Ÿè®¡</text>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-label">æ”¶å…¥</text>
        <text class="stat-value income">Â¥{{stats.income}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æ”¯å‡º</text>
        <text class="stat-value expense">Â¥{{stats.expense}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">ç»“ä½™</text>
        <text class="stat-value balance">{{stats.balance >= 0 ? '+' : ''}}Â¥{{stats.balance}}</text>
      </view>
    </view>
  </view>

  <!-- å¹´åº¦æ”¶æ”¯ç»Ÿè®¡ -->
  <view class="stats-card">
    <text class="section-title">å¹´åº¦æ”¶æ”¯ç»Ÿè®¡ï¼ˆ{{currentYear}}ï¼‰</text>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-label">æ€»æ”¶å…¥</text>
        <text class="stat-value income">Â¥{{annualStats.income}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æ€»æ”¯å‡º</text>
        <text class="stat-value expense">Â¥{{annualStats.expense}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">å¹´åº¦ç»“ä½™</text>
        <text class="stat-value balance">{{annualStats.balance >= 0 ? '+' : ''}}Â¥{{annualStats.balance}}</text>
      </view>
    </view>
  </view>

  <!-- æ¶ˆè´¹åˆ†ç±»å æ¯” -->
  <view class="chart-card">
    <text class="section-title">æ¶ˆè´¹åˆ†ç±»å æ¯”</text>
    <canvas canvas-id="categoryChart" class="chart"></canvas>
    <view class="category-list">
      <block wx:for="{{chartData.categoryData}}" wx:key="name">
        <view class="category-item">
          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <text class="category-percentage">{{item.percentage}}%</text>
          </view>
          <view class="category-bar">
            <view class="bar-fill" style="width: {{item.percentage}}%;"></view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- æ¶ˆè´¹è¶‹åŠ¿ -->
  <view class="chart-card">
    <text class="section-title">æ¶ˆè´¹è¶‹åŠ¿ï¼ˆè¿‡å»6ä¸ªæœˆï¼‰</text>
    <canvas canvas-id="trendChart" class="trend-chart"></canvas>
  </view>

  <!-- ä¸‹ä¸ªæœˆæ”¶æ”¯é¢„æµ‹ -->
  <view class="prediction-card">
    <text class="section-title">ä¸‹ä¸ªæœˆæ”¶æ”¯é¢„æµ‹</text>
    <view class="prediction-header">
      <view class="stat-item">
        <text class="stat-label">é¢„æµ‹æ”¶å…¥</text>
        <text class="stat-value income">Â¥{{nextMonthPrediction.predictedIncome}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">é¢„æµ‹æ”¯å‡º</text>
        <text class="stat-value expense">Â¥{{nextMonthPrediction.predictedExpense}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">é¢„æµ‹ç»“ä½™</text>
        <text class="stat-value balance">{{nextMonthPrediction.predictedBalance >= 0 ? '+' : ''}}Â¥{{nextMonthPrediction.predictedBalance}}</text>
      </view>
    </view>
    
    <view class="stable-expenses">
      <text class="subsection-title">ç¨³å®šæ”¯å‡ºæ˜ç»†</text>
      <view class="expense-list">
        <block wx:for="{{nextMonthPrediction.stableExpenses}}" wx:for-item="amount" wx:for-index="category" wx:key="category">
          <view class="expense-item">
            <text class="expense-category">{{category}}</text>
            <text class="expense-amount">Â¥{{amount}}</text>
          </view>
        </block>
      </view>
    </view>
    
    <view class="prediction-advice">
      <text class="subsection-title">æ¶ˆè´¹å»ºè®®</text>
      <view class="advice-list">
        <block wx:for="{{nextMonthAdvice}}" wx:key="index">
          <view class="advice-item">
            <text class="advice-icon">ğŸ’¡</text>
            <text class="advice-text">{{item}}</text>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- AIæ™ºèƒ½ç†è´¢å»ºè®® -->
  <view class="advice-card">
    <text class="section-title">AIæ™ºèƒ½ç†è´¢å»ºè®®</text>
    <view class="advice-list">
      <block wx:for="{{aiAdvice}}" wx:key="index">
        <view class="advice-item">
          <text class="advice-icon">ğŸ’¡</text>
          <text class="advice-text">{{item}}</text>
        </view>
      </block>
    </view>
  </view>
</view>